# Phase 2: YM2151 440Hz WAV Generator

このプログラムは、Nuked-OPMエミュレータを使用して440Hz（A4音）の3秒間のWAVファイルを生成します。

## 機能

- Nuked-OPMを使用したYM2151 FM音源エミュレーション
- 440Hzの純音（サイン波風）を生成
- 3秒間のステレオ16ビット44.1kHz WAVファイル出力
- FM音源レジスタ書き込み後に10msのサイクル消費を実装

## ビルド方法

### 必要なもの

- Rust (2021 edition以降)
- C コンパイラ（以下のいずれか）:
  - Zig CC (推奨、ZIG_PATH環境変数またはPATHで利用可能な場合)
  - GCC (Linux)
  - Clang (Linux/macOS)
  - MSVC (Windows) ※mingwは使用しません

### ビルドコマンド

```bash
cargo build --bin phase2
```

## 実行方法

```bash
cargo run --bin phase2
```

実行すると、カレントディレクトリに `output_440hz.wav` が生成されます。

## プログラムの構成

- `main.rs`: メインプログラム（Rust）
  - FFI バインディング
  - YM2151 制御ロジック
  - WAV ファイル生成
- `c/opm.h`, `c/opm.c`: Nuked-OPM エミュレータ（C言語）

## 実装の詳細

### FM音源設定

- チャンネル0を使用
- アルゴリズム7（全オペレータが出力に直接接続）
- 440Hz（A4音）のキーコードを設定
- 4つのオペレータのうち、キャリア（オペレータ4）のみを可聴に設定
- 高速アタック、最小ディケイで単純な音色を生成

### タイミング

- YM2151のチップクロック: 3.579545 MHz
- サンプルレート: 44.1 kHz
- レジスタ書き込み後の遅延: 10ms（約35,795サイクル）

## ライセンス

- Nuked-OPM: LGPL-2.1 (Copyright (C) 2020-2022 Nuke.YKT)
- このプログラム: プロジェクトのライセンスに従う
